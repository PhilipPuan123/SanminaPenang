using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace RVISDev
{
    public partial class FrmMain : Form
    {
        #region Declaration
        private const string MAIN_TITLE = "Robotic Vision Inspection System T01.00.00";
        private const int MESLOG_MAX_LINES = 100;
        #endregion Declaration

        #region Form Controls
        public FrmMain()
        {
            InitializeComponent();
        }

        private void FrmMain_Load(object sender, EventArgs e)
        {
            this.Text = MAIN_TITLE;
            tmrClock.Enabled = true;
            tmrClock.Interval = 1000;
            SampleUI();
            ShowDataTime();
        }

        private void tmrClock_Tick(object sender, EventArgs e)
        {
            ShowDataTime();
        }

        #region MenuStrips
        private void tsmiLogin_Click(object sender, EventArgs e)
        {
            throw new NotImplementedException();
        }

        private void tsmiExit_Click(object sender, EventArgs e)
        {
            this.Close();
        }

        private void tsmiSettings_Click(object sender, EventArgs e)
        {
            FrmSetting frmSetting = new FrmSetting();
            frmSetting.ShowDialog();
        }
        #endregion MenuStrips

        private void rtxUnitResult_TextChanged(object sender, EventArgs e)
        {
            /* set the current caret position to the end */
            rtxUnitResult.SelectionStart = rtxUnitResult.Text.Length;
            /* scroll to it */
            rtxUnitResult.ScrollToCaret();
        }
        #endregion Form Controls

        #region Functions
        private void AddLine(RichTextBox richTextBox, string line)
        {
            string text = line.TrimEnd('\0');
            if (line.Contains("PASS")) richTextBox.SelectionColor = Color.Lime;
            else if (line.Contains("FAIL")) richTextBox.SelectionColor = Color.Red;
            else richTextBox.SelectionColor = Color.White;

            richTextBox.AppendText(line + "\r\n");
        }

        /// <summary>Update date and time on UI. </summary>
        private void ShowDataTime()
        {
            ssDateTime.Text = DateTime.Now.ToString("dd-MMM-yyyy  hh:mm:ss tt");
        }

        #endregion Functions

        #region Demo
        private void SampleUI()
        {
            SampleOperatorID();
            SampleResult();
            SampleImage();
            SampleTestYield();
        }

        private void SampleOperatorID()
        {
            lblOperatorIDVal.Text = "12345";
        }

        private void SampleResult()
        {
            rtxUnitResult.Clear();
            AddLine(rtxUnitResult, "************************************************");
            AddLine(rtxUnitResult, "Start Time\t: 2018-12-11 15:42:30.123");
            AddLine(rtxUnitResult, "Serial Number\t: 18L531SPG");
            AddLine(rtxUnitResult, "************************************************");
            AddLine(rtxUnitResult, "Test Item 1\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 2\t\t\tFAIL");
            AddLine(rtxUnitResult, "Test Item 3\t\t\tFAIL");
            AddLine(rtxUnitResult, "Test Item 4\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 5\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 6\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 7\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 8\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 9\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 10\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 11\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 12\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 13\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 14\t\t\tFAIL");
            AddLine(rtxUnitResult, "Test Item 15\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 16\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 17\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 18\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 19\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 20\t\t\tFAIL");
            AddLine(rtxUnitResult, "Test Item 21\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 22\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 23\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 24\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 25\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 26\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 27\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 28\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 29\t\t\tPASS");
            AddLine(rtxUnitResult, "Test Item 30\t\t\tPASS");
            AddLine(rtxUnitResult, "************************************************");
            AddLine(rtxUnitResult, "Stop Time\t: 2018-12-11 15:59:50.452");
        }

        private void SampleImage()
        {
            Image image1 = Image.FromFile("..\\..\\img\\OKSample.png");
            Image image2 = Image.FromFile("..\\..\\img\\NGSample.png");
            /* Show master image */
            picMasterImg.Image = image1;
            picMasterImg.SizeMode = PictureBoxSizeMode.StretchImage;
            /* Show current test image */
            picTestImg.Image = image2;
            picTestImg.SizeMode = PictureBoxSizeMode.StretchImage;

            //picMasterImg.ImageLocation = "..\\..\\img\\OKSample.png";
            //picMasterImg.SizeMode = PictureBoxSizeMode.StretchImage;

        }

        private void SampleTestYield()
        {
            double total = 100;
            double pass = 95;
            double rate = pass / total;

            /* Sample test yield */
            lblTotalVal.Text = total.ToString();
            lblPassVal.Text = pass.ToString();
            lblRateVal.Text = rate.ToString("P");
        }
        #endregion Demo
    }
}
